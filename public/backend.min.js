!function(){"use strict";var t=function(){function t(t){var e=t.querySelector(".widget-group--container");this.min=Number.parseInt(e.getAttribute("data-min")),this.max=Number.parseInt(e.getAttribute("data-max")),this.elements=Array.from(e.querySelectorAll(".widget-group--element")),this.footerContainer=t.querySelector(".widget-group--footer"),this.orderField=this.footerContainer.querySelector("input[data-order]")}return t.setPosition=function(t,e){t.style.order=e.toString()},t.getPosition=function(t){return Number.parseInt(t.style.order)},t.toggleAttribute=function(t,e,r){r?e.setAttribute(t,"true"):e.removeAttribute(t)},t.prototype.init=function(){var e=this;this.updateElementStates(),this.elements.forEach((function(r){var n=e.getControls(r),o=n[0],i=n[1],a=n[2],s=n[3],d=n[4];o.addEventListener("click",(function(n){n.preventDefault();var o=t.getPosition(r);e.swap(o,o-1)})),i.addEventListener("click",(function(n){n.preventDefault();var o=t.getPosition(r);e.swap(o,o+1)})),a.addEventListener("click",(function(n){n.preventDefault();var o=t.getPosition(r);e.remove(o)})),s.addEventListener("click",(function(t){t.preventDefault(),e.updateOrderTarget(!0),r.closest("form").submit()})),d.addEventListener("dragstart",(function(e){e.dataTransfer.setData("text/plain",t.getPosition(r).toString()),r.classList.add("drag")})),d.addEventListener("dragend",(function(t){r.classList.remove("drag")})),e.makeDroppable(r.querySelector(".drop-area"),(function(n){e.move(Number.parseInt(n.dataTransfer.getData("text/plain")),t.getPosition(r))}))})),this.makeDroppable(this.footerContainer.querySelector(".drop-area"),(function(t){e.move(Number.parseInt(t.dataTransfer.getData("text/plain")),e.elements.length)}))},t.prototype.getControls=function(t){return[t.querySelector("button[data-up]"),t.querySelector("button[data-down]"),t.querySelector("button[data-remove]"),this.footerContainer.querySelector("button[data-add]"),t.querySelector("*[data-drag]")]},t.prototype.updateElementStates=function(){var e=this;this.elements.forEach((function(r,n){t.setPosition(r,n);var o=e.getControls(r),i=o[0],a=o[1],s=o[2],d=o[3],u=o[4],l=e.elements.length;t.toggleAttribute("disabled",i,0===n),t.toggleAttribute("disabled",a,l-1===n),t.toggleAttribute("disabled",s,isNaN(e.min)||l===e.min),t.toggleAttribute("disabled",d,isNaN(e.max)||l===e.max);var c=l>1;t.toggleAttribute("draggable",u,c),u.classList.toggle("disabled",!c)})),this.updateOrderTarget()},t.prototype.updateOrderTarget=function(t){void 0===t&&(t=!1);var e=this.elements.map((function(t){return Number.parseInt(t.getAttribute("data-id"))}));t&&e.push(0),this.orderField.value=e.join(",")},t.prototype.makeDroppable=function(t,e){t.addEventListener("dragenter",(function(){t.classList.add("dropping")})),t.addEventListener("dragleave",(function(){t.classList.remove("dropping")})),t.addEventListener("dragover",(function(t){t.preventDefault()})),t.addEventListener("drop",(function(r){t.classList.remove("dropping"),e(r)}))},t.prototype.swap=function(t,e){var r;r=[this.elements[e],this.elements[t]],this.elements[t]=r[0],this.elements[e]=r[1],this.updateElementStates()},t.prototype.move=function(t,e){e>t&&e--,t!==e&&(this.elements.splice(e,0,this.elements.splice(t,1)[0]),this.updateElementStates())},t.prototype.remove=function(t){this.elements[t].remove(),this.elements.splice(t,1),this.updateElementStates()},t}();document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".widget-group").forEach((function(e){new t(e).init()}))}))}();
