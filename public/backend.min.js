!function(){"use strict";var t=function(){function t(t){this.form=t.closest("form");var e=t.querySelector(".widget-group--container");this.min=Number.parseInt(e.getAttribute("data-min")),this.max=Number.parseInt(e.getAttribute("data-max")),this.elements=Array.from(e.querySelectorAll(".widget-group--element"));var r=t.querySelector(".widget-group--footer");this.orderField=r.querySelector("input[data-order]"),this.addButton=r.querySelector("button[data-add]"),this.footerDropArea=r.querySelector(".drop-area")}return t.setPosition=function(t,e){t.style.order=e.toString()},t.getPosition=function(t){return Number.parseInt(t.style.order)},t.toggleAttribute=function(t,e,r){r?e.setAttribute(t,"true"):e.removeAttribute(t)},t.getControls=function(t){return[t.querySelector("button[data-up]"),t.querySelector("button[data-down]"),t.querySelector("button[data-remove]"),t.querySelector("*[data-drag]")]},t.prototype.init=function(){var e=this;this.updateElementStates(),this.elements.forEach((function(r){var n=t.getControls(r),i=n[0],o=n[1],a=n[2],s=n[3];i.addEventListener("click",(function(n){n.preventDefault();var o=t.getPosition(r);e.swap(o,o-1),i.blur()})),o.addEventListener("click",(function(n){n.preventDefault();var i=t.getPosition(r);e.swap(i,i+1),o.blur()})),a.addEventListener("click",(function(n){n.preventDefault();var i=t.getPosition(r);e.remove(i),a.blur()})),s.addEventListener("dragstart",(function(e){e.dataTransfer.setData("text/plain",t.getPosition(r).toString()),r.classList.add("drag")})),s.addEventListener("dragend",(function(t){r.classList.remove("drag")})),e.makeDroppable(r.querySelector(".drop-area"),(function(n){e.move(Number.parseInt(n.dataTransfer.getData("text/plain")),t.getPosition(r))}))})),this.makeDroppable(this.footerDropArea,(function(t){e.move(Number.parseInt(t.dataTransfer.getData("text/plain")),e.elements.length)})),this.addButton.addEventListener("click",(function(t){t.preventDefault(),e.updateOrderTarget(!0),e.form.submit()}))},t.prototype.updateElementStates=function(){var e=this,r=this.elements.length;this.elements.forEach((function(n,i){t.setPosition(n,i);var o=t.getControls(n),a=o[0],s=o[1],d=o[2],u=o[3];t.toggleAttribute("disabled",a,0===i),t.toggleAttribute("disabled",s,r-1===i),console.log(r,e.min),t.toggleAttribute("disabled",d,isNaN(e.min)||r===e.min);var l=r>1;t.toggleAttribute("draggable",u,l),u.classList.toggle("disabled",!l)})),t.toggleAttribute("disabled",this.addButton,isNaN(this.max)||r===this.max),this.updateOrderTarget()},t.prototype.updateOrderTarget=function(t){void 0===t&&(t=!1);var e=this.elements.map((function(t){return Number.parseInt(t.getAttribute("data-id"))}));t&&e.push(-1),this.orderField.value=e.join(",")},t.prototype.makeDroppable=function(t,e){t.addEventListener("dragenter",(function(){t.classList.add("dropping")})),t.addEventListener("dragleave",(function(){t.classList.remove("dropping")})),t.addEventListener("dragover",(function(t){t.preventDefault()})),t.addEventListener("drop",(function(r){t.classList.remove("dropping"),e(r)}))},t.prototype.swap=function(t,e){var r;r=[this.elements[e],this.elements[t]],this.elements[t]=r[0],this.elements[e]=r[1],this.updateElementStates()},t.prototype.move=function(t,e){e>t&&e--,t!==e&&(this.elements.splice(e,0,this.elements.splice(t,1)[0]),this.updateElementStates())},t.prototype.remove=function(t){this.elements[t].remove(),this.elements.splice(t,1),this.updateElementStates()},t}();document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".widget-group").forEach((function(e){new t(e).init()}))}))}();
